!function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t){e.exports=require("delogger")},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),i=r(2),s=o(i),p=r(0),c=o(p),u=r(3),f=o(u),l=new f.default({sync:!0}),d=function(){function e(t){var r=this;n(this,e),this.magnet=t,this.client=new s.default,this.log=new c.default("Peer("+process.pid+")"),process.on("message",function(e){return r.handleMessage(JSON.parse(e))})}return a(e,[{key:"preprocess",value:function(e){e()}},{key:"start",value:function(){var e=this;this.preprocess(function(){e._start()})}},{key:"_start",value:function(){var e=this;this.torrent=this.client.add(this.magnet,{path:__dirname+"/../"+l.files.tmp},function(t){e.torrent=t,e.log.info("Start "+t.name),e.torrent.on("download",function(t){process.send(JSON.stringify({type:"download",metadata:e.getMetadata(e.torrent)}))}),e.torrent.on("done",function(){e.log.info("Finish "+t.name),process.send(JSON.stringify({type:"done",metadata:e.getMetadata(e.torrent)}),function(){process.exit(0)})}),e.torrent.on("noPeers",function(){e.log.warning("No peers for "+t.name),process.send(JSON.stringify({type:"noPeers",metadata:e.getMetadata(e.torrent)}))}),e.torrent.on("error",function(t){e.log.error(t),process.send(JSON.stringify({type:"error",metadata:e.getMetadata(e.torrent)}),function(){process.exit(1)})})}),this.torrent.on("metadata",function(){process.send(JSON.stringify({type:"metadata",metadata:e.getMetadata(e.torrent)}))})}},{key:"handleMessage",value:function(e){switch(e.type){case"stop":this.stop()}}},{key:"stop",value:function(){var e=this;this.client.destroy(function(t){process.send(JSON.stringify({type:"stop",metadata:e.getMetadata(e.torrent)}),function(){t?(e.log.error(t),process.exit(1)):(e.log.info("Exit properly."),process.exit(0))})})}},{key:"getMetadata",value:function(e){return{name:e.name,path:e.path,fullPath:e.path+"/"+e.name,size:e.length,hash:e.infoHash,sdown:e.downloadSpeed,sup:e.uploadSpeed,down:e.downloaded,up:e.uploaded,seed:e._peersLength,progress:e.progress,timeRemaining:e.timeRemaining}}}]),e}();!function(){if(process.argv.length>2){var e=process.argv[2];new d(e).start()}else process.exit(1)}()},function(e,t){e.exports=require("webtorrent")},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigLocation=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),p=r(4),c=o(p),u=r(0),f=o(u),l=r(5),d=o(l),h=r(6),g=r(7),y=o(g),v=t.ConfigLocation="config.json",b=function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e=e||{},r.location=process.env.CONFIG_PATH||v,r.log=new f.default("Config");var o=void 0;if(e.sync)try{var i=c.default.readFileSync(r.location);o=r.parseConfig(i),r.assignConfig(o)}catch(e){"ENOENT"===e.code?r.generateConfig():r.log.error(e)}else c.default.readFile(r.location,function(e,t){e&&"ENOENT"===e.code?r.generateConfig():e?r.log.error(e):(o=r.parseConfig(t),r.assignConfig(o))});return r}return i(t,e),s(t,[{key:"generateConfig",value:function(){var e=this;this.assignConfig(y.default),c.default.writeFile(this.location,JSON.stringify(y.default,"undefined",2),function(t){t&&e.log.error(t)})}},{key:"parseConfig",value:function(e){var t=JSON.parse(e);return(0,h.expect)(t).to.have.property("log").to.be.a("object"),(0,h.expect)(t.log).to.have.property("path").to.be.a("string").not.empty,(0,h.expect)(t).to.have.property("server").to.be.a("object"),(0,h.expect)(t.server).to.have.property("port").to.be.a("number").within(0,65535),(0,h.expect)(t.server).to.have.property("masterKey").to.be.a("string").to.have.lengthOf.above(5),(0,h.expect)(t.server).to.have.property("https"),t.server.https?((0,h.expect)(t.server.https).to.be.a("number"),(0,h.expect)(t.server).to.have.property("hostname").to.be.a("string").not.empty,(0,h.expect)(t.server).to.have.property("certs").to.be.a("object"),(0,h.expect)(t.server.certs).to.have.property("privatekey").to.be.a("string").not.empty,(0,h.expect)(t.server.certs).to.have.property("certificate").to.be.a("string").not.empty,(0,h.expect)(t.server.certs).to.have.property("chain").to.be.a("string").not.empty):(0,h.expect)(t.server.https).to.be.a("boolean"),(0,h.expect)(t).to.have.property("database").to.be.a("object"),(0,h.expect)(t.database).to.have.property("path").to.be.a("string").not.empty,(0,h.expect)(t).to.have.property("authentification").to.be.a("boolean"),(0,h.expect)(t).to.have.property("registration").to.be.a("boolean"),(0,h.expect)(t).to.have.property("files").to.be.a("object"),(0,h.expect)(t.files).to.have.property("path").to.be.a("string").not.empty,(0,h.expect)(t.files).to.have.property("tmp").to.be.a("string").not.empty,(0,h.expect)(t).to.have.property("torrent").to.be.a("object"),(0,h.expect)(t.torrent).to.have.property("providers").to.be.a("array"),t}},{key:"assignConfig",value:function(e){e.server.port=parseInt(process.env.PORT)||e.server.port,e.torrent.providers=process.env.TORRENT_PROVIDERS?process.env.TORRENT_PROVIDERS.split(","):e.torrent.providers,Object.assign(this,e),this.emit("ready")}}]),t}(d.default);t.default=b},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("chai")},function(e,t,r){"use strict";var o={log:{path:"logs/"},server:{port:5e3,masterKey:"mymasterkey",https:!1,hostname:"",certs:{privatekey:"",certificate:"",chain:""}},database:{path:"database/"},authentification:!1,registration:!0,files:{path:"files/",tmp:".tmp/"},torrent:{providers:[]}};e.exports=o,__filename.match(/.*template.*/g)&&console.log(JSON.stringify(o,"undefined",2))}]);